function Invoke-OGDDialog-Koffiezetapparaat {
    param(
        #Create the entire menu from nested hashtables
        [hashtable]$menu = @{
            "Espresso" = @{
                "Melk"              = {$state.self.inventory += 'een kop espresso met melk'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop espresso en doet er nog wat melk bij."
                } #End Melk
                "Suiker"            = {$state.self.inventory += 'een kop espresso met suiker'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop espresso en doet er nog wat suiker bij."
                } #End Suiker
                "Melk en suiker"    = {$state.self.inventory += 'een kop espresso met melk en suiker'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop espresso en doet er nog wat melk en suiker bij."
                } #End Melk en suiker
                "Geen toevoegingen" = {$state.self.inventory += 'een kop espresso'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop espresso en doet er verder niets in."
                } #End Geen toevoegingen
            } #End Espresso
            "Black coffee" = @{
                "Melk"              = {$state.self.inventory += 'een kop koffie met melk'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop koffie en doet er nog wat melk bij."
                } #End Melk
                "Suiker"            = {$state.self.inventory += 'een kop koffie met suiker'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop koffie en doet er nog wat suiker bij."
                } #End Suiker
                "Melk en suiker"    = {$state.self.inventory += 'een kop koffie met melk en suiker'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop koffie en doet er nog wat melk en suiker bij."
                } #End Melk en suiker
                "Geen toevoegingen" = {$state.self.inventory += 'een kop koffie'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop koffie en doet er verder niets in."
                } #End Geen toevoegingen
            } #End Black coffee
            "Cappuccino" = @{
                "Melk"              = {$state.self.inventory += 'een kop cappuccino met melk'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop cappuccino en doet er nog wat melk bij. Dat is wel gek, he?"
                } #End Melk
                "Suiker"            = {$state.self.inventory += 'een kop cappuccino met suiker'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop cappuccino en doet er nog wat suiker bij."
                } #End Suiker
                "Melk en suiker"    = {$state.self.inventory += 'een kop cappuccino met melk en suiker'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop cappuccino en doet er nog wat melk en suiker bij. Dat is wel gek, he?"
                } #End Melk en suiker
                "Geen toevoegingen" = {$state.self.inventory += 'een kop cappuccino'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop cappuccino en doet er verder niets in."
                } #End Geen toevoegingen
            } #End Cappuccino
            "Latte macchiato" = @{
                "Melk"              = {$state.self.inventory += 'een kop latte macchiato met melk'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop latte macchiato en doet er nog wat melk bij. Dat is wel gek, he?"
                } #End Melk
                "Suiker"            = {$state.self.inventory += 'een kop latte macchiato met suiker'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop latte macchiato en doet er nog wat suiker bij."
                } #End Suiker
                "Melk en suiker"    = {$state.self.inventory += 'een kop latte macchiato met melk en suiker'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop latte macchiato en doet er nog wat melk en suiker bij. Dat is wel gek, he?"
                } #End Melk en suiker
                "Geen toevoegingen" = {$state.self.inventory += 'een kop latte macchiato'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop latte macchiato en doet er verder niets in."
                } #End Geen toevoegingen
            } #End Latte macchiato
            "Caffelatte" = @{
                "Melk"              = {$state.self.inventory += 'een kop caffè latte met melk'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop caffè latte en doet er nog wat melk bij. Dat is wel gek, he?"
                } #End Melk
                "Suiker"            = {$state.self.inventory += 'een kop caffè latte met suiker'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop caffè latte en doet er nog wat suiker bij."
                } #End Suiker
                "Melk en suiker"    = {$state.self.inventory += 'een kop caffè latte met melk en suiker'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop caffè latte en doet er nog wat melk en suiker bij. Dat is wel gek, he?"
                } #End Melk en suiker
                "Geen toevoegingen" = {$state.self.inventory += 'een kop caffè latte'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop caffè latte en doet er verder niets in."
                } #End Geen toevoegingen
            } #End Caffelatte
            "Choco" = @{
                "suiker"            = {$state.self.inventory += 'een kop chocolademelk met extra suiker'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kopje chocolademelk en doet er nog wat suiker bij. Jij zoetekouw."
                } #End Suiker
                "Geen toevoegingen" = {$state.self.inventory += 'een kop chocolademelk'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop chocolademelk."
                } #End Geen toevoegingen
            } #End Choco
            "Mocha" = @{
                "Melk"              = {$state.self.inventory += 'een kop espresso met melk'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop espresso en doet er nog wat melk bij. Dat is wel gek, he?"
                } #End Melk
                "Suiker"            = {$state.self.inventory += 'een kop espresso met suiker'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop espresso en doet er nog wat suiker bij."
                } #End Suiker
                "Melk en suiker"    = {$state.self.inventory += 'een kop espresso met melk en suiker'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop espresso en doet er nog wat melk en suiker bij. Dat is wel gek, he?"
                } #End Melk en suiker
                "Geen toevoegingen" = {$state.self.inventory += 'een kop espresso'
                                       $state.self.states += 'Drankje'
                                       $global:ActionMessage = "Je zet een kop espresso en doet er verder niets in."
                } #End Geen toevoegingen
            } #End Mocha
            "Hot water" = @{
                "English Breakfast" = @{
                    "Geen suiker"          = {$state.self.inventory += 'een kop English Breakfast thee'
                                              $state.self.states += 'Drankje'
                                              $global:ActionMessage = "Je zet een kop English Breakfast, zonder suiker."
                    } #End Geen suiker
                    "Een klontje suiker"   = {$state.self.inventory += 'een kop English Breakfast met suiker'
                                              $state.self.states += 'Drankje'
                                              $global:ActionMessage = "Je zet een kop English Breakfast, met een klontje suiker."
                    } #End Een klontje suiker
                    "Twee klontjes suiker" = {$state.self.inventory += 'een kop English Breakfast met dubbel suiker'
                                              $state.self.states += 'Drankje'
                                              $global:ActionMessage = "Je zet een kop English Breakfast, met twee klontjes suiker. Zoetekouw!"
                    } #End Twee klontjes suiker
                } #End English Breakfast
                "Bosvruchten" = @{
                    "Geen suiker"          = {$state.self.inventory += 'een kop bosvruchtenthee'
                                              $state.self.states += 'Drankje'
                                              $global:ActionMessage = "Je zet een kop bosvruchtenthee, zonder suiker."
                    } #End Geen suiker
                    "Een klontje suiker"   = {$state.self.inventory += 'een kop bosvruchtenthee met suiker'
                                              $state.self.states += 'Drankje'
                                              $global:ActionMessage = "Je zet een kop bosvruchtenthee, met een klontje suiker."
                    } #End Een klontje suiker
                    "Twee klontjes suiker" = {$state.self.inventory += 'een kop English Breakfast met dubbel suiker'
                                              $state.self.states += 'Drankje'
                                              $global:ActionMessage = "Je zet een kop bosvruchtenthee, met twee klontjes suiker. Zoetekouw!"
                    } #End Twee klontjes suiker
                } #End Bosvruchten
                "Sterrenmunt" = @{
                    "Geen suiker"          = {$state.self.inventory += 'een kop sterrenmunt'
                                              $state.self.states += 'Drankje'
                                              $global:ActionMessage = "Je zet een kop sterrenmunt, zonder suiker."
                    } #End Geen suiker
                    "Een klontje suiker"   = {$state.self.inventory += 'een kop sterrenmunt met suiker'
                                              $state.self.states += 'Drankje'
                                              $global:ActionMessage = "Je zet een kop sterrenmunt, met een klontje suiker."
                    } #End Een klontje suiker
                    "Twee klontjes suiker" = {$state.self.inventory += 'een kop sterrenmunt met dubbel suiker'
                                              $state.self.states += 'Drankje'
                                              $global:ActionMessage = "Je zet een kop sterrenmunt, met twee klontjes suiker. Zoetekouw!"
                    } #End Twee klontjes suiker
                } #End Sterrenmunt
                "Rooibos" = @{
                    "Geen suiker"          = {$state.self.inventory += 'een kop rooibosthee'
                                              $state.self.states += 'Drankje'
                                              $global:ActionMessage = "Je zet een kop rooibosthee, zonder suiker."
                    } #End Geen suiker
                    "Een klontje suiker"   = {$state.self.inventory += 'een kop rooibosthee met suiker'
                                              $state.self.states += 'Drankje'
                                              $global:ActionMessage = "Je zet een kop rooibosthee, met een klontje suiker."
                    } #End Een klontje suiker
                    "Twee klontjes suiker" = {$state.self.inventory += 'een kop rooibosthee met dubbel suiker'
                                              $state.self.states += 'Drankje'
                                              $global:ActionMessage = "Je zet een kop rooibosthee, met twee klontjes suiker. Zoetekouw!"
                    } #End Twee klontjes suiker
                } #End Rooibos
            } #End Hot water
        } #End menu
    ) #End param
        
    #-------------------------
    #region Menu logic
    #-------------------------

    # Check to see if there is already a drankje in inventory. if so, exit function and state reason
    If (($State.self.states) -contains "Drankje") {
    $global:ActionMessage = "Je hebt al een drankje in je hand. Er nog een nemen heeft geen toegevoegde waarde en beperkt je wel in het openen van deuren. Je bedenkt je en zet niet nog een kop."
    Break
    } 

    $ValidChoice = $false
    #Loop through the following until $ValidChoice is false
    while(-not $validChoice){
        #Build default screen components
        Clear-Host
        Show-Header
        Write-Host ""
        Write-Host $ActionMessage -ForegroundColor Green #Write the latest action to screen
        Write-Host ""


        #Fill variable with the entire first level of the menu hashtable.
        $keuzekeys = @($menu.Keys)
        $i = 1

        #Loop through all themenu options and write them to screen in a numbered list.
        foreach($key in $keuzekeys){
            Write-Host "${i}: $key"
            $i++
        }
        
        #Ask user for input (a number from the list)
        Write-Host ""
        $keuze = read-host "Selecteer optienummer"

        #Check the following and if it doesn't match, to go catch
        try{
            #Set selected item to the number imputted minus one (because a hashtable starts at 0)
            $keuzekey = $keuzekeys[$keuze-1]
            
            #Select item from menu, corresponding to the user input
            $GekozenActie = $menu.$keuzekey
            
            #All items in the menu are either hashtables (submenus) or scriptblocks (menu ends with executions). This checks for a hashtable and inputs that as new options for the next menu level
            if($GekozenActie -is [hashtable]){
                Invoke-OGDDialog-Koffiezetapparaat -menu $gekozenactie
            }
            
            #All items in the menu are either hashtables (submenus) or scriptblocks (menu ends with executions). This checks for a scriptblock and executes it.
            if($gekozenactie -is [scriptblock]){
                Invoke-Command -ScriptBlock $gekozenactie -NoNewScope
            }
        
            $ValidChoice = $true
        
        }catch{
         #If the option selected is neither leading to the next menu, nor a scriptblock, write error and go back in the try loop
         Write-Host 'Ongeldig commando, probeer het nog eens.'
         Start-Sleep -Seconds 1
        }
    } #End while loop
#endregion

} #End Invoke-OGDDialog-General
